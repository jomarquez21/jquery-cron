!function(e){for(var t={initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:void 0,disallowEmpty:!0,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:void 0,disallowEmpty:!0,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:void 0,rows:10,disallowEmpty:!0,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:void 0,disallowEmpty:!0,title:void 0},dowOpts:{minWidth:100,itemWidth:void 0,columns:void 0,rows:void 0,disallowEmpty:!0,title:void 0},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:void 0,disallowEmpty:!0,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:void 0,customValues:void 0,allowMultiple_all:!1,allowMultiple_dom:!1,allowMultiple_month:!1,allowMultiple_dow:!1,allowMultiple_minute:!1,allowMultiple_timeHour:!1,allowMultiple_timeMinute:!1,onChange:void 0,useGentleSelect:!1},o="",n=0;n<60;n++){o+="<option value='"+n+"'>"+(n<10?"0":"")+n+"</option>\n"}var l="";for(n=0;n<24;n++){l+="<option value='"+n+"'>"+(n<10?"0":"")+n+"</option>\n"}var i="";for(n=1;n<32;n++){if(1==n||21==n||31==n)var a="st";else if(2==n||22==n)a="nd";else if(3==n||23==n)a="rd";else a="th";i+="<option value='"+n+"'>"+n+a+"</option>\n"}var r="",s=["January","February","March","April","May","June","July","August","September","October","November","December"];for(n=0;n<s.length;n++)r+="<option value='"+(n+1)+"'>"+s[n]+"</option>\n";var c="",d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(n=0;n<d.length;n++)c+="<option value='"+n+"'>"+d[n]+"</option>\n";var u="",m=["minute","hour","day","week","month","year"];for(n=0;n<m.length;n++)u+="<option value='"+m[n]+"'>"+m[n]+"</option>\n";var p={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]},h={minute:/^(\*\s){4}\*$/,hour:/^[\d,]+\s(\*\s){3}\*$/,day:/^([\d,]+\s){2}(\*\s){2}\*$/,week:/^([\d,]+\s){2}(\*\s){2}[\d,]+$/,month:/^([\d,]+\s){3}\*\s\*$/,year:/^([\d,]+\s){4}\*$/};function v(e){return void 0!==e}function f(t,o){if(v(o.customValues))for(key in o.customValues)if(t==o.customValues[key])return key;if("string"==typeof t&&/^(([\d,]+|\*) +){4}([\d,]+|\*)$/.test(t)){var n=t.split(" ");if(5==n.length){for(var l=[0,0,1,1,0],i=[59,23,31,12,6],a=[o.allowMultiple_all||o.allowMultiple_timeMinute||o.allowMultiple_minute,o.allowMultiple_all||o.allowMultiple_timeHour,o.allowMultiple_all||o.allowMultiple_dom,o.allowMultiple_all||o.allowMultiple_month,o.allowMultiple_all||o.allowMultiple_dow],r=0;r<n.length;r++)if("*"!=n[r]){var s=n[r].split(",").map(function(e){return parseInt(e,10)});if(!a[r]&&s.length>1)return void e.error("cron: unexpected multi-value cron entry");e.each(s,function(t,o){(!v(o)||o<l[r]||o>i[r])&&e.error("cron: invalid cron value (column "+r+")")})}for(var c in h)if(h[c].test(t))return n[0].indexOf(",")>=0&&("hour"==c&&!o.allowMultiple_minute||"hour"!=c&&!o.allowMultiple_timeMinute)?void e.error("cron: unexpected multi-value cron entry"):c;e.error("cron: valid but unsupported cron format. sorry.")}else e.error("cron: invalid initial value")}else e.error("cron: invalid initial value")}function w(t,o){if(!v(f(o.initial,o)))return!0;if(v(n=o.customValues)&&"object"!=typeof n)return!0;var n;if(v(o.customValues))for(key in o.customValues)if(h.hasOwnProperty(key))return e.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}var y={init:function(n){var a=n||{},s=e.extend([],t,a),d=e.extend({},t.effectOpts,a.effectOpts);if(e.extend(s,{minuteOpts:e.extend({},t.minuteOpts,d,a.minuteOpts),domOpts:e.extend({},t.domOpts,d,a.domOpts),monthOpts:e.extend({},t.monthOpts,d,a.monthOpts),dowOpts:e.extend({},t.dowOpts,d,a.dowOpts),timeHourOpts:e.extend({},t.timeHourOpts,d,a.timeHourOpts),timeMinuteOpts:e.extend({},t.timeMinuteOpts,d,a.timeMinuteOpts)}),w(0,s))return this;var m=[],p="",h=s.customValues;if(v(h))for(var f in h)p+="<option value='"+h[f]+"'>"+f+"</option>\n";m.period=e("<span class='cron-period'>Every <select name='cron-period'>"+p+u+"</select> </span>").appendTo(this).data("root",this);var M=m.period.find("select");M.bind("change.cron",g.periodChanged).data("root",this),s.useGentleSelect&&M.gentleSelect(d);var O=" multiple='multiple'",b=s.allowMultiple_all?O:"",k=s.allowMultiple_dom?O:b;m.dom=e("<span class='cron-block cron-block-dom'> on the <select name='cron-dom'"+k+">"+i+"</select> </span>").appendTo(this).data("root",this),M=m.dom.find("select").data("root",this),s.useGentleSelect&&M.gentleSelect(s.domOpts),k=s.allowMultiple_month?O:b,m.month=e("<span class='cron-block cron-block-month'> of <select name='cron-month'"+k+">"+r+"</select> </span>").appendTo(this).data("root",this),M=m.month.find("select").data("root",this),s.useGentleSelect&&M.gentleSelect(s.monthOpts),k=s.allowMultiple_minute?O:b,m.mins=e("<span class='cron-block cron-block-mins'> at <select name='cron-mins'"+k+">"+o+"</select> minutes past the hour </span>").appendTo(this).data("root",this),M=m.mins.find("select").data("root",this),s.useGentleSelect&&M.gentleSelect(s.minuteOpts),k=s.allowMultiple_dow?O:b,m.dow=e("<span class='cron-block cron-block-dow'> on <select name='cron-dow'"+k+">"+c+"</select> </span>").appendTo(this).data("root",this),M=m.dow.find("select").data("root",this),s.useGentleSelect&&M.gentleSelect(s.dowOpts),k=s.allowMultiple_timeHour?O:b;var _=s.allowMultiple_timeMinute?O:b;return m.time=e("<span class='cron-block cron-block-time'> at <select name='cron-time-hour' class='cron-time-hour'"+k+">"+l+"</select>:<select name='cron-time-min' class='cron-time-min'"+_+">"+o+" </span>").appendTo(this).data("root",this),M=m.time.find("select.cron-time-hour").data("root",this),s.useGentleSelect&&M.gentleSelect(s.timeHourOpts),M=m.time.find("select.cron-time-min").data("root",this),s.useGentleSelect&&M.gentleSelect(s.timeMinuteOpts),m.controls=e("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",g.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",g.somethingChanged),this.data("options",s).data("block",m),this.data("current_value",s.initial),y.value.call(this,s.initial)},value:function(e){if(!e)return function(e){var t=e.data("block"),o=hour=day=month=dow="*",n=t.period.find("select").val();switch(n){case"minute":break;case"hour":o=t.mins.find("select").val();break;case"day":o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val();break;case"week":o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),dow=t.dow.find("select").val();break;case"month":o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val();break;case"year":o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),month=t.month.find("select").val();break;default:return n}return[o,hour,day,month,dow].join(" ")}(this);var t=this.data("options"),o=this.data("block"),n=t.useGentleSelect,l=f(e,t);if(!v(l))return!1;if(v(t.customValues)&&t.customValues.hasOwnProperty(l))l=t.customValues[l];else for(var i=e.split(" "),a={mins:(i=e.split(" ").map(function(e){var t=e.split(",");return 1==t.length?t[0]:t}))[0],hour:i[1],dom:i[2],month:i[3],dow:i[4]},r=p[l],s=0;s<r.length;s++){var c=r[s];if("time"==c){var d=o[c].find("select.cron-time-hour").val(a.hour);n&&d.gentleSelect("update"),d=o[c].find("select.cron-time-min").val(a.mins),n&&d.gentleSelect("update")}else{d=o[c].find("select").val(a[c]);n&&d.gentleSelect("update")}}var u=o.period.find("select").val(l);return n&&u.gentleSelect("update"),u.trigger("change"),this}},g={periodChanged:function(){var t=e(this).data("root"),o=t.data("block"),n=(t.data("options"),e(this).val());if(t.find("span.cron-block").hide(),p.hasOwnProperty(n))for(var l=p[e(this).val()],i=0;i<l.length;i++)o[l[i]].show()},somethingChanged:function(){root=e(this).data("root"),v(root.data("options").url_set)?y.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var t=root.data("options").onChange;v(t)&&e.isFunction(t)&&t.call(root)},saveClicked:function(){var t=e(this),o=t.data("root"),n=y.value.call(o);t.hasClass("cron-loading")||(t.addClass("cron-loading"),e.ajax({type:"POST",url:o.data("options").url_set,data:{cron:n},success:function(){o.data("current_value",n),t.removeClass("cron-loading"),n==y.value.call(o)&&(o.removeClass("cron-changed"),o.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),t.removeClass("cron-loading")}}))}};e.fn.cron=function(t){return y[t]?y[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.cron"):y.init.apply(this,arguments)}}(jQuery);
